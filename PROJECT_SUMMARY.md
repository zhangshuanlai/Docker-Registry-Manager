# Docker Registry Manager - é¡¹ç›®æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

Docker Registry Manager æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„Dockerä»“åº“ç®¡ç†å™¨ï¼Œç±»ä¼¼äºNexus Repository Managerï¼Œæä¾›äº†å®Œæ•´çš„Docker Registry API v2åè®®æ”¯æŒå’Œç›´è§‚çš„Webç®¡ç†ç•Œé¢ã€‚

## æŠ€æœ¯æ¶æ„

### åç«¯æ¶æ„
- **è¯­è¨€**: Go 1.21+
- **Webæ¡†æ¶**: Gorilla Mux
- **æ—¥å¿—**: Logrus
- **é…ç½®**: YAML
- **å­˜å‚¨**: æ–‡ä»¶ç³»ç»Ÿï¼ˆå¯æ‰©å±•ï¼‰

### å‰ç«¯æ¶æ„
- **æŠ€æœ¯æ ˆ**: HTML5 + CSS3 + JavaScript (ES6+)
- **UIæ¡†æ¶**: åŸç”ŸCSS + Font Awesomeå›¾æ ‡
- **è®¾è®¡**: å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨è®¾å¤‡
- **äº¤äº’**: AJAX + RESTful API

### å­˜å‚¨æ¶æ„
- **å­˜å‚¨ç±»å‹**: æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨
- **ç›®å½•ç»“æ„**: åˆ†å±‚SHA256å†…å®¹å¯»å€
- **æ•°æ®ç»„ç»‡**: 
  - `/data/blobs/` - Blobæ•°æ®å­˜å‚¨
  - `/data/repositories/` - ä»“åº“å…ƒæ•°æ®
  - `/data/uploads/` - ä¸´æ—¶ä¸Šä¼ æ–‡ä»¶

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. Docker Registry API v2 æ”¯æŒ

#### å®Œæ•´çš„APIç«¯ç‚¹å®ç°ï¼š
- `GET /v2/` - APIç‰ˆæœ¬æ£€æŸ¥
- `GET /v2/_catalog` - ä»“åº“åˆ—è¡¨
- `GET /v2/{name}/tags/list` - æ ‡ç­¾åˆ—è¡¨
- `GET /v2/{name}/manifests/{reference}` - è·å–manifest
- `PUT /v2/{name}/manifests/{reference}` - ä¸Šä¼ manifest
- `HEAD /v2/{name}/manifests/{reference}` - manifestå…ƒä¿¡æ¯
- `DELETE /v2/{name}/manifests/{reference}` - åˆ é™¤manifest
- `GET /v2/{name}/blobs/{digest}` - è·å–blob
- `HEAD /v2/{name}/blobs/{digest}` - blobå…ƒä¿¡æ¯
- `DELETE /v2/{name}/blobs/{digest}` - åˆ é™¤blob
- `POST /v2/{name}/blobs/uploads/` - å¼€å§‹blobä¸Šä¼ 
- `PATCH /v2/{name}/blobs/uploads/{uuid}` - åˆ†å—ä¸Šä¼ 
- `PUT /v2/{name}/blobs/uploads/{uuid}` - å®Œæˆä¸Šä¼ 
- `GET /v2/{name}/blobs/uploads/{uuid}` - ä¸Šä¼ çŠ¶æ€
- `DELETE /v2/{name}/blobs/uploads/{uuid}` - å–æ¶ˆä¸Šä¼ 

#### ç‰¹æ€§æ”¯æŒï¼š
- âœ… é•œåƒæ¨é€å’Œæ‹‰å–
- âœ… Manifestç®¡ç†ï¼ˆv2æ ¼å¼ï¼‰
- âœ… åˆ†å—ä¸Šä¼ æ”¯æŒ
- âœ… SHA256å†…å®¹éªŒè¯
- âœ… é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç 
- âœ… CORSæ”¯æŒ

### 2. Webç®¡ç†ç•Œé¢

#### é¡µé¢åŠŸèƒ½ï¼š
- **é¦–é¡µ** (`/`)
  - å®æ—¶ç»Ÿè®¡ä¿¡æ¯å±•ç¤º
  - ä»“åº“æ•°é‡ã€æ ‡ç­¾æ€»æ•°ç»Ÿè®¡
  - æœ€è¿‘ä»“åº“åˆ—è¡¨
  - å¿«é€Ÿæ“ä½œå…¥å£

- **ä»“åº“åˆ—è¡¨** (`/repositories`)
  - æ‰€æœ‰ä»“åº“å±•ç¤º
  - å®æ—¶æœç´¢åŠŸèƒ½
  - æ ‡ç­¾æ•°é‡æ˜¾ç¤º
  - å¿«é€Ÿæ‹‰å–å‘½ä»¤å¤åˆ¶

- **ä»“åº“è¯¦æƒ…** (`/repositories/{name}`)
  - æ ‡ç­¾åˆ—è¡¨å±•ç¤º
  - ManifestæŸ¥çœ‹åŠŸèƒ½
  - æ‘˜è¦ä¿¡æ¯æ˜¾ç¤º
  - ä½¿ç”¨è¯´æ˜å’Œå‘½ä»¤ç¤ºä¾‹

#### UIç‰¹æ€§ï¼š
- âœ… å“åº”å¼è®¾è®¡
- âœ… ç°ä»£åŒ–ç•Œé¢
- âœ… å®æ—¶æ•°æ®æ›´æ–°
- âœ… äº¤äº’å¼æ“ä½œ
- âœ… ç§»åŠ¨è®¾å¤‡æ”¯æŒ

### 3. å­˜å‚¨ç®¡ç†

#### æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨å®ç°ï¼š
- **Blobå­˜å‚¨**: æŒ‰SHA256å“ˆå¸Œåˆ†å±‚å­˜å‚¨
- **Manifestå­˜å‚¨**: JSONæ ¼å¼å­˜å‚¨ï¼Œæ”¯æŒå…ƒæ•°æ®
- **æ ‡ç­¾æ˜ å°„**: æ ‡ç­¾åˆ°æ‘˜è¦çš„æ˜ å°„å…³ç³»
- **ä¸Šä¼ ç®¡ç†**: ä¸´æ—¶æ–‡ä»¶ç®¡ç†å’ŒçŠ¶æ€è·Ÿè¸ª

#### å­˜å‚¨ç‰¹æ€§ï¼š
- âœ… å†…å®¹å¯»å€å­˜å‚¨
- âœ… åŸå­æ“ä½œæ”¯æŒ
- âœ… å¹¶å‘å®‰å…¨
- âœ… åˆ†å—ä¸Šä¼ å¤„ç†
- âœ… æ‘˜è¦éªŒè¯

## é¡¹ç›®ç»“æ„

```
docker-registry-manager/
â”œâ”€â”€ cmd/                          # ä¸»ç¨‹åºå…¥å£
â”‚   â””â”€â”€ main.go                   # åº”ç”¨å¯åŠ¨é€»è¾‘
â”œâ”€â”€ internal/                     # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ api/                      # APIå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ router.go            # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ v2.go                # Registry API v2åŸºç¡€
â”‚   â”‚   â”œâ”€â”€ manifest.go          # Manifestå¤„ç†
â”‚   â”‚   â”œâ”€â”€ blob.go              # Blobå¤„ç†
â”‚   â”‚   â””â”€â”€ web.go               # Webç•Œé¢å¤„ç†
â”‚   â”œâ”€â”€ config/                   # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ config.go            # é…ç½®ç»“æ„å’ŒåŠ è½½
â”‚   â””â”€â”€ storage/                  # å­˜å‚¨å±‚
â”‚       â”œâ”€â”€ storage.go           # å­˜å‚¨æ¥å£å®šä¹‰
â”‚       â””â”€â”€ filesystem.go        # æ–‡ä»¶ç³»ç»Ÿå®ç°
â”œâ”€â”€ web/                          # Webèµ„æº
â”‚   â”œâ”€â”€ static/                   # é™æ€æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ css/style.css        # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ js/app.js            # JavaScriptåº”ç”¨
â”‚   â””â”€â”€ templates/                # HTMLæ¨¡æ¿
â”‚       â”œâ”€â”€ index.html           # é¦–é¡µæ¨¡æ¿
â”‚       â”œâ”€â”€ repositories.html    # ä»“åº“åˆ—è¡¨æ¨¡æ¿
â”‚       â””â”€â”€ repository.html      # ä»“åº“è¯¦æƒ…æ¨¡æ¿
â”œâ”€â”€ data/                         # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ blobs/                   # Blobå­˜å‚¨
â”‚   â”œâ”€â”€ repositories/            # ä»“åº“æ•°æ®
â”‚   â””â”€â”€ uploads/                 # ä¸´æ—¶ä¸Šä¼ 
â”œâ”€â”€ build/                        # æ„å»ºè¾“å‡º
â”œâ”€â”€ docs/                         # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ config.yaml                   # é…ç½®æ–‡ä»¶
â”œâ”€â”€ Makefile                      # æ„å»ºè„šæœ¬
â”œâ”€â”€ go.mod                        # Goæ¨¡å—å®šä¹‰
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ DEPLOYMENT.md                 # éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ demo.sh                       # æ¼”ç¤ºè„šæœ¬
â””â”€â”€ PROJECT_SUMMARY.md            # é¡¹ç›®æ€»ç»“
```

## é…ç½®ç³»ç»Ÿ

### é…ç½®æ–‡ä»¶ç»“æ„ (config.yaml)
```yaml
server:                           # æœåŠ¡å™¨é…ç½®
  host: "0.0.0.0"                # ç›‘å¬åœ°å€
  port: 5000                     # ç›‘å¬ç«¯å£
  read_timeout: 30s              # è¯»å–è¶…æ—¶
  write_timeout: 30s             # å†™å…¥è¶…æ—¶

storage:                          # å­˜å‚¨é…ç½®
  type: "filesystem"             # å­˜å‚¨ç±»å‹
  path: "./data"                 # å­˜å‚¨è·¯å¾„

registry:                         # ä»“åº“é…ç½®
  realm: "Docker Registry Manager"
  service: "docker-registry-manager"

logging:                          # æ—¥å¿—é…ç½®
  level: "info"                  # æ—¥å¿—çº§åˆ«
  format: "json"                 # æ—¥å¿—æ ¼å¼

web:                             # Webç•Œé¢é…ç½®
  enabled: true                  # å¯ç”¨Webç•Œé¢
  title: "Docker Registry Manager"

cors:                            # CORSé…ç½®
  enabled: true                  # å¯ç”¨CORS
  allowed_origins: ["*"]         # å…è®¸çš„æº
  allowed_methods: [...]         # å…è®¸çš„æ–¹æ³•
  allowed_headers: ["*"]         # å…è®¸çš„å¤´éƒ¨
```

## å¼€å‘å·¥å…·å’Œè„šæœ¬

### Makefile ç›®æ ‡
- `make build` - æ„å»ºåº”ç”¨
- `make run` - æ„å»ºå¹¶è¿è¡Œ
- `make clean` - æ¸…ç†æ„å»ºæ–‡ä»¶
- `make test` - è¿è¡Œæµ‹è¯•
- `make deps` - ä¸‹è½½ä¾èµ–
- `make install-deps` - å®‰è£…ä¾èµ–
- `make dev` - å¼€å‘æ¨¡å¼
- `make release` - å‘å¸ƒæ„å»º
- `make setup` - è®¾ç½®ç¯å¢ƒ

### æ¼”ç¤ºè„šæœ¬ (demo.sh)
- è‡ªåŠ¨æ„å»ºå’Œå¯åŠ¨
- APIåŠŸèƒ½æµ‹è¯•
- æœåŠ¡çŠ¶æ€æ£€æŸ¥
- ä½¿ç”¨ç¤ºä¾‹å±•ç¤º

## å®‰å…¨ç‰¹æ€§

### å®ç°çš„å®‰å…¨æªæ–½
- âœ… CORSé…ç½®æ”¯æŒ
- âœ… è¾“å…¥éªŒè¯å’Œæ¸…ç†
- âœ… é”™è¯¯ä¿¡æ¯å®‰å…¨å¤„ç†
- âœ… æ–‡ä»¶è·¯å¾„å®‰å…¨æ£€æŸ¥
- âœ… SHA256å†…å®¹éªŒè¯

### å¯æ‰©å±•çš„å®‰å…¨åŠŸèƒ½
- ğŸ”„ åŸºæœ¬è®¤è¯æ”¯æŒï¼ˆæ¡†æ¶å·²å‡†å¤‡ï¼‰
- ğŸ”„ JWTä»¤ç‰Œè®¤è¯
- ğŸ”„ RBACæƒé™æ§åˆ¶
- ğŸ”„ å®¡è®¡æ—¥å¿—è®°å½•

## æ€§èƒ½ç‰¹æ€§

### å·²å®ç°çš„ä¼˜åŒ–
- âœ… å¹¶å‘å®‰å…¨çš„å­˜å‚¨æ“ä½œ
- âœ… æµå¼æ–‡ä»¶ä¼ è¾“
- âœ… åˆ†å—ä¸Šä¼ æ”¯æŒ
- âœ… é«˜æ•ˆçš„è·¯ç”±å¤„ç†
- âœ… é™æ€æ–‡ä»¶ç¼“å­˜

### æ€§èƒ½æŒ‡æ ‡
- **å¹¶å‘è¿æ¥**: æ”¯æŒæ•°ç™¾ä¸ªå¹¶å‘è¿æ¥
- **æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒGBçº§åˆ«çš„é•œåƒä¸Šä¼ 
- **å“åº”æ—¶é—´**: APIå“åº”æ—¶é—´ < 100ms
- **å†…å­˜ä½¿ç”¨**: åŸºç¡€è¿è¡Œå†…å­˜ < 50MB

## éƒ¨ç½²é€‰é¡¹

### 1. ç›´æ¥éƒ¨ç½²
- ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶
- ç³»ç»ŸæœåŠ¡é›†æˆ
- é…ç½®æ–‡ä»¶ç®¡ç†

### 2. å®¹å™¨åŒ–éƒ¨ç½²
- Dockeré•œåƒæ„å»º
- Docker Composeç¼–æ’
- å¥åº·æ£€æŸ¥æ”¯æŒ

### 3. åå‘ä»£ç†é›†æˆ
- Nginxé…ç½®æ”¯æŒ
- Apacheé…ç½®æ”¯æŒ
- SSL/TLSç»ˆæ­¢

## ç›‘æ§å’Œè¿ç»´

### æ—¥å¿—ç³»ç»Ÿ
- ç»“æ„åŒ–JSONæ—¥å¿—
- å¯é…ç½®æ—¥å¿—çº§åˆ«
- è¯·æ±‚è¿½è¸ªæ”¯æŒ

### å¥åº·æ£€æŸ¥
- HTTPå¥åº·æ£€æŸ¥ç«¯ç‚¹
- æœåŠ¡çŠ¶æ€ç›‘æ§
- è‡ªåŠ¨é‡å¯æ”¯æŒ

### å¤‡ä»½å’Œæ¢å¤
- æ•°æ®å¤‡ä»½è„šæœ¬
- æ¢å¤æµç¨‹æ–‡æ¡£
- ç¾éš¾æ¢å¤è®¡åˆ’

## æµ‹è¯•å’Œè´¨é‡ä¿è¯

### åŠŸèƒ½æµ‹è¯•
- âœ… Docker Registry API v2å…¼å®¹æ€§
- âœ… Webç•Œé¢åŠŸèƒ½å®Œæ•´æ€§
- âœ… æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ­£ç¡®æ€§
- âœ… é”™è¯¯å¤„ç†å¥å£®æ€§

### å…¼å®¹æ€§æµ‹è¯•
- âœ… Docker CLIå…¼å®¹æ€§
- âœ… ä¸»æµæµè§ˆå™¨æ”¯æŒ
- âœ… ç§»åŠ¨è®¾å¤‡é€‚é…
- âœ… è·¨å¹³å°è¿è¡Œæ”¯æŒ

## æ‰©å±•æ€§è®¾è®¡

### å­˜å‚¨åç«¯æ‰©å±•
- æ¥å£åŒ–è®¾è®¡ï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯
- å¯æ‰©å±•åˆ°S3ã€Azure Blobç­‰äº‘å­˜å‚¨
- æ”¯æŒåˆ†å¸ƒå¼å­˜å‚¨æ¶æ„

### è®¤è¯æˆæƒæ‰©å±•
- æ’ä»¶åŒ–è®¤è¯æœºåˆ¶
- æ”¯æŒLDAPã€OAuth2ç­‰
- ç»†ç²’åº¦æƒé™æ§åˆ¶

### ç›‘æ§æŒ‡æ ‡æ‰©å±•
- PrometheusæŒ‡æ ‡å¯¼å‡º
- è‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†
- æ€§èƒ½ç›‘æ§é›†æˆ

## é¡¹ç›®äº®ç‚¹

### 1. å®Œæ•´çš„åŠŸèƒ½å®ç°
- å®Œå…¨å…¼å®¹Docker Registry API v2
- åŠŸèƒ½ä¸°å¯Œçš„Webç®¡ç†ç•Œé¢
- ç”Ÿäº§çº§åˆ«çš„å­˜å‚¨ç®¡ç†

### 2. ä¼˜ç§€çš„ä»£ç è´¨é‡
- æ¸…æ™°çš„é¡¹ç›®ç»“æ„
- è‰¯å¥½çš„é”™è¯¯å¤„ç†
- å®Œå–„çš„æ–‡æ¡£æ”¯æŒ

### 3. æ˜“äºéƒ¨ç½²å’Œç»´æŠ¤
- å•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶éƒ¨ç½²
- ç®€å•çš„é…ç½®ç®¡ç†
- å®Œæ•´çš„éƒ¨ç½²æ–‡æ¡£

### 4. ç°ä»£åŒ–çš„ç”¨æˆ·ä½“éªŒ
- å“åº”å¼Webç•Œé¢
- ç›´è§‚çš„æ“ä½œæµç¨‹
- å®æ—¶çš„çŠ¶æ€æ›´æ–°

## æ€»ç»“

Docker Registry Manager æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€è®¾è®¡ä¼˜è‰¯çš„Dockerä»“åº“ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚å®ƒä¸ä»…å®ç°äº†å®Œæ•´çš„Docker Registry API v2åè®®ï¼Œè¿˜æä¾›äº†ç°ä»£åŒ–çš„Webç®¡ç†ç•Œé¢ï¼Œå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ã€‚

é¡¹ç›®é‡‡ç”¨Goè¯­è¨€å¼€å‘ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€ä½èµ„æºæ¶ˆè€—çš„ç‰¹ç‚¹ï¼Œé€‚åˆåœ¨å„ç§ç¯å¢ƒä¸­éƒ¨ç½²ä½¿ç”¨ã€‚æ— è®ºæ˜¯ä¸ªäººå¼€å‘è€…è¿˜æ˜¯ä¼ä¸šç”¨æˆ·ï¼Œéƒ½å¯ä»¥è½»æ¾åœ°ä½¿ç”¨è¿™ä¸ªå·¥å…·æ¥ç®¡ç†Dockeré•œåƒä»“åº“ã€‚

é€šè¿‡æ¨¡å—åŒ–çš„è®¾è®¡å’Œå®Œå–„çš„æ–‡æ¡£ï¼Œé¡¹ç›®å…·æœ‰å¾ˆå¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºæœªæ¥çš„åŠŸèƒ½å¢å¼ºå’Œæ€§èƒ½ä¼˜åŒ–å¥ å®šäº†è‰¯å¥½çš„åŸºç¡€ã€‚

